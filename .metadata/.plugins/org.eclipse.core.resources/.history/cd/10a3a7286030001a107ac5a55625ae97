ackage com.bridgelabz.felloship.main;

import java.io.IOException;
import java.util.List;
import java.util.Scanner;

import com.bridgelabz.felloship.control.StockControl;
import com.bridgelabz.felloship.model.StockUser;
import com.bridgelabz.felloship.model.stockmodel;
import com.bridgelabz.felloship.operation.StockOperations;
import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.JsonMappingException;

public class StockAccount {
	static Scanner sc = new Scanner(System.in);
	static String spath = StockOperations.spath;

	public static void main(String[] args) throws JsonParseException, JsonMappingException, IOException {
		getshares();
		saleshare();
		adduser();
	}

	private static void adduser() throws JsonParseException, JsonMappingException, IOException {
		List<StockUser> newuser = StockControl.readusers();
		for (StockUser stockUser : newuser) {
			newuser.add(stockUser);
		}
		StockUser newentry = new StockUser();

		System.out.println("enter user name");
		newentry.setUsername(sc.next());
		System.out.println("enter address");
		newentry.setUseraddress(sc.next());
		System.out.println("enter contact number");
		newentry.setUsercontact(sc.next());
		System.out.println("enter age");
		newentry.setUserage(sc.nextInt());
		if (newentry.getUserage() > 18) {
			System.out.println("sorry your under 18..");
		} else {
			newuser.add(newentry);
			StockControl.writeusers(newuser);
		}
	}

	private static void saleshare() throws JsonParseException, JsonMappingException, IOException {
		StockOperations.Displaystock();
		System.out.println("username");
		String username = sc.next();
		List<StockUser> user = StockControl.readusers();
		for (StockUser stockUser : user) {
			if (stockUser.getUsername().equals(username)) {
				System.out.println("enter company symbol");
				String inputsymbol = sc.next();
				List<stockmodel> list = StockControl.readStock(spath);
				for (stockmodel stockmodel : list) {
					if (stockmodel.companysimbol.equals(inputsymbol)) {
						System.out.println("enter share amount");
						int shares = sc.nextInt();
						System.out.println("your shares is : " + shares + "\n per share price: " + stockmodel.shareprice
								+ "\ntotl price is: " + shares * stockmodel.shareprice);
						stockmodel.setCompanyavailableshare(stockmodel.companyavailableshare + shares);
					}
				}
				StockControl.writeStock(list);
			}
		}
	}

	private static void getshares() throws JsonParseException, JsonMappingException, IOException {
		StockOperations.Displaystock();
		System.out.println("user name");
		String username = sc.next();
		List<StockUser> user = StockControl.readusers();
		for (StockUser stockUser : user) {
			if (stockUser.getUsername().equals(username)) {
				System.out.println("enter company symbol");
				String inputsymbol = sc.next();
				List<stockmodel> list = StockControl.readStock(spath);
				for (stockmodel stockmodel : list) {
					if (stockmodel.companysimbol.equals(inputsymbol)) {
						System.out.println("welcome to " + stockmodel.companyname);
						System.out.println("availabe Share is: " + stockmodel.companyavailableshare);
						System.out.println("price per share is: " + stockmodel.shareprice);

						System.out.println("no. of share you want?");
						int getshare = sc.nextInt();

						System.out
								.println("your " + getshare + " share of price is " + getshare * stockmodel.shareprice);
						stockmodel.setCompanyavailableshare(stockmodel.companyavailableshare - getshare);

					}
				}
				StockControl.writeStock(list);

			} else {
				System.out.println("your are not authorised user\nplease register your self....");
			}
		}

		StockOperations.Displaystock();
	}

}
